<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/pngl" href="book.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Codex Game Systems</title>
    <link rel="stylesheet" href="shelf.css" />
    <script type="module">
      import { parse } from 'yaml'

      // Loader wrapper to shallow parse story metadata before redirecting
      globalThis.loadStory = async function (storyUrl) {
        const res = await fetch(storyUrl)
        const text = await res.text()
        const storyData = parse(text)

        console.log(`Loaded story: ${storyData.title} (${storyData.system})`)

        window.location.href = `/sys/${storyData.system}/?story=${storyUrl}`
      }

      // If storyUrl is provided in query string, load that story directly
      const params = new URLSearchParams(window.location.search)
      const storyParam = params.get('storyUrl')
      if (storyParam) {
        loadStory(storyParam)
      }
    </script>
  </head>

  <body>
    <div class="container">
      <h1>ðŸ“š Game Library</h1>

      <div class="bookshelf">
        <h2>Fantasy</h2>
        <div class="shelf">
          <div class="book decorative deco-1"></div>
          <a class="book fantasy-1" href="#" onclick="loadStory('/story/cave.yaml')">Caves Of Infinite Testing</a>
          <div class="book decorative deco-2"></div>
          <div class="book decorative deco-3"></div>
          <a class="book fantasy-2" href="#" onclick="loadStory('/story/warlock.yaml')">Warlock Of Firetop Mountain</a>
          <div class="book decorative deco-3"></div>
        </div>
        <div class="shelf-base"></div>
      </div>

      <div class="bookshelf">
        <h2>Science Fiction</h2>
        <div class="shelf">
          <div class="book decorative deco-2"></div>
          <a class="book scifi-1" href="#" onclick="loadStory('/story/station-omega.yaml')">Crisis On Station Omega</a>
          <div class="book decorative deco-1"></div>
          <div class="book decorative deco-3"></div>
        </div>
        <div class="shelf-base"></div>
      </div>
    </div>
  </body>
</html>
